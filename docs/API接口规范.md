# WEB新闻发布系统 - API接口规范

> **重要提示：** 所有开发人员必须严格遵循此规范！

## 📋 目录

1. [基础规范](#基础规范)
2. [统一返回格式](#统一返回格式)
3. [错误码定义](#错误码定义)

---

## 📌 基础规范

### 1. 请求地址
```
基础URL: https://localhost:5001/api
开发环境: http://localhost:5000/api
```

### 2. 请求方式
- 查询数据：`GET`
- 创建数据：`POST`
- 更新数据：`PUT`
- 删除数据：`DELETE`

### 3. 数据格式
- 请求格式：`application/json`
- 返回格式：`application/json`
- 字符编码：`UTF-8`

### 4. 命名规范
- 路由命名：小写字母 + 中划线（如：`/api/news-list`）
- 参数命名：小驼峰（如：`userId`）
- 返回字段：小驼峰（如：`userName`）

---

## 📦 统一返回格式

### 成功响应（200）

```json
{
  "success": true,
  "code": 200,
  "message": "操作成功",
  "data": {
    // 具体数据
  },
  "timestamp": "2025-12-03T10:30:00Z"
}
```

### 失败响应（400/401/500等）

```json
{
  "success": false,
  "code": 400,
  "message": "错误信息描述",
  "data": null,
  "timestamp": "2025-12-03T10:30:00Z"
}
```

## 🔢 错误码定义

### 通用错误码（1000-1999）

| 错误码 | 说明 |
|--------|------|
| 1000 | 系统错误 |
| 1001 | 参数错误 |
| 1002 | 数据不存在 |
| 1003 | 数据已存在 |
| 1004 | 操作失败 |

### 认证错误码（2000-2999）

| 错误码 | 说明 |
|--------|------|
| 2000 | 未登录 |
| 2001 | 登录已过期 |
| 2002 | 无权限访问 |
| 2003 | Token无效 |
| 2004 | 用户名或密码错误 |
| 2005 | 用户已存在 |

### 业务错误码（3000-3999）

| 错误码 | 说明 |
|--------|------|
| 3001 | 新闻不存在 |
| 3002 | 新闻标题不能为空 |
| 3003 | 新闻内容不能为空 |
| 3004 | 附件不存在 |
| 3005 | 文件上传失败 |
| 3006 | 文件格式不支持 |
| 3007 | 文件大小超过限制 |

---

## 🧪 测试规范

### 1. 测试顺序（推荐）

```
1. POST /api/auth/register  （注册用户）
2. POST /api/auth/login     （登录获取Token）
3. POST /api/news           （发布新闻）
4. GET  /api/news           （查看列表）
5. GET  /api/news/{id}      （查看详情）
6. POST /api/news/{id}/attachments  （上传附件）
7. GET  /api/attachments/{id}/download  （下载附件）
8. GET  /api/users          （获取用户列表）
9. POST /api/news/{id}/receivers  （设置接收人）
```

### 3. 测试用例模板

每个接口需要测试以下场景：

- ✅ 正常情况（200）
- ❌ 参数缺失（400）
- ❌ 未登录（401）
- ❌ 数据不存在（404）
- ❌ 系统错误（500）

---

## 📝 开发检查清单

### 每个接口开发完成后检查：

- [ ] 是否使用统一的返回格式 `ApiResponse<T>`
- [ ] 是否正确处理了异常
- [ ] 是否添加了必要的验证（参数验证）
- [ ] 是否添加了 `[Authorize]` 特性（如果需要认证）
- [ ] 是否在Swagger上测试通过
- [ ] 是否有清晰的注释
- [ ] 是否符合命名规范

---

## 🔍 常见问题

### Q1: 为什么要使用统一返回格式？
A: 便于前端统一处理，减少沟通成本。

### Q2: 什么时候需要添加 [Authorize]？
A: 除了注册和登录，其他接口都需要。

### Q3: 如何获取当前登录用户？
A: 从 JWT Token 中获取：`User.FindFirst("userId")?.Value`

### Q4: 文件上传怎么处理？
A: 使用 `IFormFile` 参数，保存到 `wwwroot/uploads` 文件夹。

### Q5: 如何测试需要认证的接口？
A: 先登录获取Token，然后在Swagger中点击Authorize按钮输入Token。

---

**文档版本：** v1.0  
**最后更新：** 2025-12-03  
**维护人：** 组长

**如有疑问，请在群里提问！**

